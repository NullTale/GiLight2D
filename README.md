# GiLight2D

## Что это

Unity Urp Render Feature for 2D Global Illumination.<br>
На практике это подход к освещению при котором свечение и тени образуются естественным способом и отсутствует ограничение на количество источников света.<br>
Реализовано достаточно много опций, проверена на unity 2021 и 2022 версиях.<br>

#### Среди опций
* фиксированное разрешение для pixel art.
* рендер в текстуру для использования ее потом в шейдере или в камеру для применения встроенных пост эффектов.
* набивка граници экрана для отображения объектов за пределами камеры.
* разные настройки шума и его разрешение.
* и др.


## Установка и использование
Установить через PackageManager `https://github.com/NullTale/GiLight2D.git`. <br>
<img src="https://user-images.githubusercontent.com/1497430/213906801-7cab3334-5626-46b8-9966-d5c0b6107edc.png">

Добавить `GiLight2DFeature` в Urp Renderer (urp должен быть настроен).<br>
Если сцена пустая этого уже должно быть достаточно чтобы увидить эффект.

<img src="https://user-images.githubusercontent.com/1497430/213907330-64d37b07-2833-4f8e-8b62-88455c05d604.png"><br>
<sup>Три спрайта на пустой сцене.</sup>

Дальше настроить маску объектов и выходную текстуру которую можно потом использховать в шейдере (имя должно совпадать).<br>
![image](https://user-images.githubusercontent.com/1497430/213907087-464a1822-a902-45ca-90f5-dd4dab9ffc19.png)

Теперь текстуру можно использовать из шейдера.<br> 
UrpRenderer настроен так чтобы не рисовать Gi объекты по маске.

![image](https://user-images.githubusercontent.com/1497430/213909802-45824d6d-7307-416f-b6f9-caebc7f45032.png)<br>
<sup>Спрайт квадрата использует Gi текстуру из экранных координат (галочка `Exposed` должна быть снята).</sup>

## Как это работает
Общая идея такая что из каждого пикселя выпускаются лучи во всех направлениях, из суммы тех лучей которые попали в источник света получается финальный цвет пикселя.<Br> В конечном счете должна быть просчитана текстура освещения которую потом можно как то применять.<Br> При таком подходе свечение и тени образуются естественным способом. 

Чтобы эффективно считать лучи создается sdf карта, по факту это карта расстояний до ближайшего источника света, она используется чтобы получать дистанцию смещения луча при поиске источника света.<Br>
Таким образом весь рендер состоит из трех этапов: рендер объектов в буффер, создание карты расстояний с помощью jfa алгоритма, применение gi шейдера. 

Почти все вычисления происходят во фрагментном шейдере, от чего количество объектов не влияет на производительность, но сильно зависить от разрешения.